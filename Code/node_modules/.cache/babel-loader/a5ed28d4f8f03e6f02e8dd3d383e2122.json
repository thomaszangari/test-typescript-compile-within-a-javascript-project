{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\tomsa\\\\OneDrive\\\\Desktop\\\\ReactExampleCode\\\\test-typescript-compile-within-a-javascript-project\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\tomsa\\\\OneDrive\\\\Desktop\\\\ReactExampleCode\\\\test-typescript-compile-within-a-javascript-project\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\tomsa\\\\OneDrive\\\\Desktop\\\\ReactExampleCode\\\\test-typescript-compile-within-a-javascript-project\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\tomsa\\\\OneDrive\\\\Desktop\\\\ReactExampleCode\\\\test-typescript-compile-within-a-javascript-project\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{Button}from\"react-bootstrap\";import\"react-datepicker/dist/react-datepicker.css\";import{Line}from'react-chartjs-2';import SystemSearch from'../systemsearch';import ReactTable from\"../PaginatedTable/ReactTable\";import AppToast from\"../toast\";import config from\"../config\";import moment from\"moment\";import{ExportToCsv}from'export-to-csv';import'./SystemStats.css';var SystemStats=/*#__PURE__*/function(_React$Component){_inherits(SystemStats,_React$Component);var _super=_createSuper(SystemStats);function SystemStats(props){var _this;_classCallCheck(this,SystemStats);_this=_super.call(this,props);_this.data={labels:[],datasets:[{label:'Alerts',fill:false,lineTension:0,backgroundColor:'rgba(75,192,192,0.4)',borderColor:'rgba(75,192,192,1)',borderCapStyle:'butt',borderDash:[],borderDashOffset:0.0,borderJoinStyle:'miter',pointBorderColor:'rgba(75,192,192,1)',pointBackgroundColor:'#fff',pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:'rgba(75,192,192,1)',pointHoverBorderColor:'rgba(220,220,220,1)',pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:[]}]};_this.options={scales:{xAxes:[{type:'time',time:{unit:'day'},ticks:{fontColor:\"white\",fontSize:14},gridLines:{color:'rgb(255, 255, 255, 0.2)'}}],yAxes:[{ticks:{fontColor:\"white\",fontSize:14},gridLines:{color:'rgb(255, 255, 255, 0.2)'}}]},legend:{labels:{fontColor:\"white\",fontSize:12}},maintainAspectRatio:false};_this.CSVoptions={showLabels:true,useTextFile:false,useBom:true,//useKeysAsHeaders: true,\nheaders:['Time UTC','Time','Description','Context','Type','Details','Priority','Category','ID','-']};_this.csvExporter=new ExportToCsv(_this.CSVoptions);_this.onSearchClick=function(){var categorySelected=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var queryDateRangeStart=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var queryDateRangeEnd=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var querySearchText=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';var startDate=new Date(queryDateRangeStart);var momentStartDate=moment(startDate).utc().format();var endDate=new Date(queryDateRangeEnd);endDate.setHours(23,59,59);var momentEndDate=moment(endDate).utc().format();var query=\"?startDate=\".concat(momentStartDate,\"&endDate=\").concat(momentEndDate,\"&category=\").concat(categorySelected,\"&searchText=\").concat(querySearchText);_this.fetchSystemDetails(query);};_this.handleSelectClick=function(event,id){event.preventDefault();_this.navigateTo('/system/details',id);};_this.navigateTo=function(path,id){if(id!=''){_this.props.history.push({pathname:path,state:{detail:id}});}else{_this.props.history.push(path);}};_this.setSystemDetails=function(res){var data=res.hits.hits;data.forEach(function(hit){_this.incDataSetValues(hit._source.eventDateTimeUTC);});_this.setState({'graphData':_this.data});var rows=Object.values(data).map(function(d){var temp=d._id;d=d._source;d._id=temp;d.details=/*#__PURE__*/React.createElement(\"a\",{onClick:function onClick(e){return _this.handleSelectClick(e,d._id);},href:\"\",className:\"select-link\"},\"Details\");return d;});rows.forEach(function(element){return element.eventDateTime=moment(element.eventDateTime).format();});_this.setState({'statsList':rows});};_this.state={graphData:_this.data,statsList:[],tableHeader:[{key:'category',label:'Category'},{key:'priority',label:'Priority'},{key:'eventDateTime',label:'Date'},{key:'eventType',label:'Type'},{key:'eventDescription',label:'Description'},{key:'details',label:'Details'}],showToast:false};return _this;}_createClass(SystemStats,[{key:\"incDataSetValues\",value:function incDataSetValues(datetime){var date=new Date(datetime);for(var i=0;i<this.data.datasets[0].data.length;i++){//var storedDate = this.playerData.datasets[0].data[i].y;\nif(date.getTime()>this.data.datasets[0].data[i].x.getTime()){if(i==this.data.datasets[0].data.length-1){this.data.datasets[0].data[i].y++;}else{if(date.getTime()<this.data.datasets[0].data[i+1].x.getTime()){this.data.datasets[0].data[i].y++;}}}}}},{key:\"populateDataSet\",value:function populateDataSet(queryStr){var segments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;var startStr=queryStr.substring(11,31);var endStr=queryStr.substring(40,60);var startMoment=moment(startStr);var endMoment=moment(endStr);var diffMS=endMoment.diff(startMoment);var diffSegment=Math.ceil(diffMS/segments);var ts=endMoment.valueOf();this.data.datasets[0].data=[];this.data.labels=[];for(var i=0;i<segments;i++){var date=new Date(ts);var dateData={x:date,y:0};this.data.datasets[0].data.unshift(dateData);this.data.labels.unshift(date);ts=ts-diffSegment;}}},{key:\"fetchSystemDetails\",value:function fetchSystemDetails(){var _this2=this;var queryStr=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';if(queryStr==''){console.log('no query string passed');}else{this.populateDataSet(queryStr,12);var url=\"\".concat(config.LOG_SERVER_BASE_URL,\"/v1/log/stats\").concat(queryStr);fetch(url,{method:'GET',headers:{'Authorization':\"Bearer \".concat(localStorage.getItem('accessToken')),'Content-Type':'application/json'}}).then(function(response){return response.json();}).then(function(res){if(res.error){console.log(res.error);}else{_this2.setSystemDetails(res);}}).catch(function(error){_this2.setState({showError:true,errorMessage:error.toString()});});}}},{key:\"componentDidMount\",value:function componentDidMount(){var data=null;if(this.props.location.state==undefined){this.props.history.push('/system/dashboard');}else{var query=this.props.location.state.detail;this.fetchSystemDetails(query);}}},{key:\"downloadClicked\",value:function downloadClicked(data){//debugger;\n//const {details, eventDateTime, tempData} = data;\nthis.csvExporter.generateCsv(data);}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,tableHeader=_this$state.tableHeader,statsList=_this$state.statsList,graphData=_this$state.graphData,showToast=_this$state.showToast;var msg='No Results found.';return/*#__PURE__*/React.createElement(\"div\",{className:\"system-stats\"},/*#__PURE__*/React.createElement(\"div\",{className:\"graph-container\"},/*#__PURE__*/React.createElement(Line,{data:graphData,options:this.options,redraw:true})),/*#__PURE__*/React.createElement(\"div\",{className:\"search-container\"},/*#__PURE__*/React.createElement(SystemSearch,{handleSearchClick:this.onSearchClick})),/*#__PURE__*/React.createElement(\"div\",{className:\"table-container\"},tableHeader&&statsList?/*#__PURE__*/React.createElement(ReactTable,{tableHeader:tableHeader,rowData:statsList,className:\"update-stats-table\"}):null),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{className:\"system-search-btn\",onClick:function onClick(){return _this3.downloadClicked(statsList);}},\"Export\")),showToast?/*#__PURE__*/React.createElement(AppToast,{showToast:showToast,message:msg,isSuccessMessage:true,handleClose:this.onToastClose}):null);}}]);return SystemStats;}(React.Component);export default SystemStats;","map":{"version":3,"sources":["C:/Users/tomsa/OneDrive/Desktop/ReactExampleCode/test-typescript-compile-within-a-javascript-project/Code/src/systemstats/SystemStats.js"],"names":["React","Button","Line","SystemSearch","ReactTable","AppToast","config","moment","ExportToCsv","SystemStats","props","data","labels","datasets","label","fill","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","options","scales","xAxes","type","time","unit","ticks","fontColor","fontSize","gridLines","color","yAxes","legend","maintainAspectRatio","CSVoptions","showLabels","useTextFile","useBom","headers","csvExporter","onSearchClick","categorySelected","queryDateRangeStart","queryDateRangeEnd","querySearchText","startDate","Date","momentStartDate","utc","format","endDate","setHours","momentEndDate","query","fetchSystemDetails","handleSelectClick","event","id","preventDefault","navigateTo","path","history","push","pathname","state","detail","setSystemDetails","res","hits","forEach","hit","incDataSetValues","_source","eventDateTimeUTC","setState","rows","Object","values","map","d","temp","_id","details","e","element","eventDateTime","graphData","statsList","tableHeader","key","showToast","datetime","date","i","length","getTime","x","y","queryStr","segments","startStr","substring","endStr","startMoment","endMoment","diffMS","diff","diffSegment","Math","ceil","ts","valueOf","dateData","unshift","console","log","populateDataSet","url","LOG_SERVER_BASE_URL","fetch","method","localStorage","getItem","then","response","json","error","catch","showError","errorMessage","toString","location","undefined","generateCsv","msg","downloadClicked","onToastClose","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {Button} from \"react-bootstrap\";\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport {Line} from 'react-chartjs-2';\r\nimport SystemSearch from '../systemsearch';\r\nimport ReactTable from \"../PaginatedTable/ReactTable\";\r\nimport AppToast from \"../toast\";\r\nimport config from \"../config\";\r\nimport moment from \"moment\";\r\nimport {ExportToCsv} from 'export-to-csv';\r\n\r\nimport './SystemStats.css';\r\n\r\nclass SystemStats extends React.Component {  \r\n\r\n    data = {\r\n        labels: [],\r\n        datasets: [\r\n          {\r\n            label: 'Alerts',\r\n            fill: false,\r\n            lineTension: 0,\r\n            backgroundColor: 'rgba(75,192,192,0.4)',\r\n            borderColor: 'rgba(75,192,192,1)',\r\n            borderCapStyle: 'butt',\r\n            borderDash: [],\r\n            borderDashOffset: 0.0,\r\n            borderJoinStyle: 'miter',\r\n            pointBorderColor: 'rgba(75,192,192,1)',\r\n            pointBackgroundColor: '#fff',\r\n            pointBorderWidth: 1,\r\n            pointHoverRadius: 5,\r\n            pointHoverBackgroundColor: 'rgba(75,192,192,1)',\r\n            pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n            pointHoverBorderWidth: 2,\r\n            pointRadius: 1,\r\n            pointHitRadius: 10,\r\n            data: []\r\n          }\r\n        ],        \r\n    }\r\n\r\n    \r\n    options = {\r\n        scales: {\r\n            xAxes: [{\r\n                type: 'time',\r\n                time: {\r\n                    unit: 'day'\r\n                },\r\n                ticks: {\r\n                    fontColor: \"white\",\r\n                    fontSize: 14,\r\n                },\r\n                gridLines: {\r\n                    color: 'rgb(255, 255, 255, 0.2)'\r\n                }\r\n            }],\r\n            yAxes: [{\r\n                ticks: {\r\n                    fontColor: \"white\",\r\n                    fontSize: 14,\r\n                },\r\n                gridLines: {\r\n                    color: 'rgb(255, 255, 255, 0.2)'\r\n                }\r\n            }]\r\n        },\r\n        legend: {\r\n            labels: {\r\n                fontColor: \"white\",\r\n                fontSize: 12\r\n            }\r\n        },\r\n        maintainAspectRatio: false\r\n    }\r\n\r\n    CSVoptions = {\r\n        showLabels: true,\r\n        useTextFile: false,\r\n        useBom: true,\r\n        //useKeysAsHeaders: true,\r\n        headers: ['Time UTC', 'Time', 'Description', 'Context', 'Type', 'Details', 'Priority', 'Category', 'ID', '-']\r\n    };\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            graphData: this.data,\r\n            statsList: [],\r\n            tableHeader: [{key: 'category', label: 'Category'},\r\n                        {key: 'priority', label: 'Priority'},\r\n                        {key: 'eventDateTime', label: 'Date'},\r\n                        {key: 'eventType', label: 'Type'},\r\n                        {key: 'eventDescription', label: 'Description'},\r\n                        {key: 'details', label: 'Details'}],\r\n            showToast: false\r\n        }\r\n    }\r\n\r\n    csvExporter = new ExportToCsv(this.CSVoptions);\r\n\r\n    incDataSetValues(datetime){\r\n        var date = new Date(datetime);\r\n            for (var i = 0; i < this.data.datasets[0].data.length; i++){\r\n                //var storedDate = this.playerData.datasets[0].data[i].y;\r\n                if (date.getTime() > this.data.datasets[0].data[i].x.getTime()){\r\n                    if (i == this.data.datasets[0].data.length - 1){\r\n                        this.data.datasets[0].data[i].y++;                    \r\n                    } else{\r\n                        if(date.getTime() < this.data.datasets[0].data[i + 1].x.getTime()){\r\n                            this.data.datasets[0].data[i].y++;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n    populateDataSet(queryStr, segments = 12){\r\n\r\n        var startStr = queryStr.substring(11, 31);\r\n        var endStr = queryStr.substring(40, 60);\r\n        var startMoment = moment(startStr);\r\n        var endMoment = moment(endStr);\r\n        var diffMS = endMoment.diff(startMoment);\r\n\r\n        var diffSegment = Math.ceil(diffMS/segments);\r\n        var ts = endMoment.valueOf();\r\n\r\n        this.data.datasets[0].data = [];\r\n        this.data.labels = [];\r\n\r\n        for(var i = 0; i < segments; i++){\r\n            var date = new Date(ts);\r\n\r\n            var dateData = {\r\n                x: date,\r\n                y: 0\r\n            }\r\n            \r\n            this.data.datasets[0].data.unshift(dateData);\r\n            this.data.labels.unshift(date);\r\n\r\n            ts = ts - (diffSegment);\r\n        }\r\n       }\r\n\r\n    onSearchClick = (categorySelected = '', queryDateRangeStart = '', queryDateRangeEnd = '', querySearchText = '') => {\r\n        var startDate = new Date(queryDateRangeStart);\r\n        const momentStartDate = moment(startDate).utc().format();\r\n        var endDate = new Date (queryDateRangeEnd);\r\n        endDate.setHours(23, 59, 59);        \r\n        const momentEndDate = moment(endDate).utc().format();\r\n\r\n        var query = `?startDate=${momentStartDate}&endDate=${momentEndDate}&category=${categorySelected}&searchText=${querySearchText}`;\r\n\r\n        this.fetchSystemDetails(query);\r\n    }\r\n\r\n    fetchSystemDetails(queryStr = ''){\r\n        if(queryStr == ''){\r\n            console.log('no query string passed');\r\n        } else {\r\n            \r\n            this.populateDataSet(queryStr, 12);\r\n            \r\n            let url = `${config.LOG_SERVER_BASE_URL}/v1/log/stats${queryStr}`;\r\n            fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,\r\n                    'Content-Type': 'application/json',\r\n                }\r\n                })\r\n                .then(response => response.json())\r\n                .then(res => {\r\n                    if (res.error) {\r\n                        console.log(res.error);\r\n                    } else {\r\n                        this.setSystemDetails(res);\r\n                    }\r\n                })\r\n                .catch((error) => {\r\n                    this.setState({showError: true, errorMessage: error.toString()})\r\n                });\r\n        }\r\n    }\r\n\r\n    handleSelectClick = (event, id) => {\r\n        event.preventDefault();\r\n        this.navigateTo('/system/details', id);\r\n    }\r\n\r\n    navigateTo = (path, id) => {\r\n        if(id != ''){\r\n            this.props.history.push({pathname: path, state: { detail: id }});\r\n        }\r\n        else{\r\n            this.props.history.push(path);\r\n        }\r\n    }\r\n\r\n    setSystemDetails = (res) => {\r\n        var data = res.hits.hits;\r\n        data.forEach((hit) => {\r\n            this.incDataSetValues(hit._source.eventDateTimeUTC);\r\n        });\r\n\r\n        this.setState({'graphData': this.data});\r\n\r\n        const rows = Object.values(data).map(d => {\r\n            var temp = d._id;\r\n            d = d._source;\r\n            d._id = temp;\r\n            d.details = <a onClick={(e) => this.handleSelectClick(e, d._id)} href='' className='select-link'>Details</a>;\r\n\r\n            return d;\r\n        });\r\n        rows.forEach(element => element.eventDateTime = moment(element.eventDateTime).format());\r\n\r\n        this.setState({'statsList': rows});\r\n    }\r\n\r\n    componentDidMount() {\r\n        var data = null;\r\n\r\n        if (this.props.location.state == undefined){\r\n            this.props.history.push('/system/dashboard');\r\n        }\r\n        else\r\n        {\r\n            var query = this.props.location.state.detail;\r\n            this.fetchSystemDetails(query);\r\n        }\r\n    }\r\n\r\n    downloadClicked(data) {\r\n        //debugger;\r\n        //const {details, eventDateTime, tempData} = data;\r\n        this.csvExporter.generateCsv(data);\r\n    }\r\n\r\n    render() {\r\n        const {tableHeader, statsList, graphData, showToast} = this.state;        \r\n        const msg = 'No Results found.';\r\n        return(\r\n            <div className='system-stats'>\r\n                <div className='graph-container'>\r\n                    <Line data={graphData}\r\n                    options={this.options} redraw />\r\n                </div>\r\n                <div className='search-container'>\r\n                    <SystemSearch handleSearchClick={this.onSearchClick}/>\r\n                </div>\r\n                <div className='table-container'>\r\n                {\r\n                    tableHeader && statsList\r\n                        ? <ReactTable tableHeader={tableHeader} rowData={statsList} className='update-stats-table'/>\r\n                        : null\r\n                }\r\n                </div>\r\n                <div>\r\n                    <Button className='system-search-btn'\r\n                            onClick={() => this.downloadClicked(statsList)}>Export</Button>\r\n                </div>\r\n                {\r\n                    showToast ? <AppToast showToast={showToast} message={msg} isSuccessMessage={true}\r\n                                          handleClose={this.onToastClose}/> : null\r\n                }\r\n            </div>\r\n        ) \r\n    }\r\n}\r\n\r\nexport default SystemStats;"]},"metadata":{},"sourceType":"module"}